// ==UserScript==
// @name        Swearify Image Utility
// @namespace   samsquanchhunter
// @include     *
// @version     alpha.1.3
// @icon        http://i.imgur.com/MnWNRBL.png
// @grant       none
// ==/UserScript==
'use strict';Element.prototype.remove=function(){this.parentElement.removeChild(this)};function C(){document.addEventListener("contextmenu",D,!1);if(0===document.getElementsByTagName("menu").length){var a=document.createElement("menu");a.id="userscript-grease";a.type="context"}else a=document.getElementsByTagName("menu")[0];var c=document.createElement("menuitem");c.id="menu_imgre";c.label="Resize and Upload";c.icon="http://i.imgur.com/F2wghzO.png";a.appendChild(c);document.body.appendChild(a);document.querySelector("#userscript-grease #menu_imgre").addEventListener("click",E,!1)}function D(a){document.body.setAttribute("contextmenu","userscript-grease");var c=a.target;link=a.target.getAttribute("imageURL");a=document.querySelector("#userscript-grease #menu_imgre");"img"==c.localName?(a.disabled=!1,a.setAttribute("imageURL",c.src)):a.disabled=!0}function E(){var a=window.location.origin,c=document.getElementById("menu_imgre").getAttribute("imageurl");console.log(a+" "+c);a=document.createElement("canvas");a.id="canvasImg";a.style="display:none;";document.body.appendChild(a);F()}function F(){var a=document.getElementById("canvasImg"),c=a.getContext("2d"),b=new Image;b.crossOrigin="Anonymous";b.onload=function(){var k=b.width,h=b.height;a.width=k;a.height=h;c.drawImage(b,0,0);var f=Math.round(50/h*k),l,y=Date.now(),f=Math.round(f);l=Math.round(50);for(var g=a.getContext("2d").getImageData(0,0,k,h),B=a.getContext("2d").getImageData(0,0,f,l),g=g.data,q=B.data,r=k/f,t=h/l,G=Math.ceil(r/2),H=Math.ceil(t/2),m=0;m<l;m++)for(var n=0;n<f;n++){for(var u=4*(n+m*f),d=0,p=0,z=0,A=gx_g=gx_b=gx_a=0,I=(m+.5)*t,v=Math.floor(m*t);v<(m+1)*t;v++)for(var w=Math.abs(I-(v+.5))/H,J=(n+.5)*r,w=w*w,x=Math.floor(n*r);x<(n+1)*r;x++){var e=Math.abs(J-(x+.5))/G,d=Math.sqrt(w+e*e);-1<=d&&1>=d&&(d=2*d*d*d-3*d*d+1,0<d&&(e=4*(x+v*k),gx_a+=d*g[e+3],z+=d,255>g[e+3]&&(d=d*g[e+3]/250),A+=d*g[e],gx_g+=d*g[e+1],gx_b+=d*g[e+2],p+=d))}q[u]=A/p;q[u+1]=gx_g/p;q[u+2]=gx_b/p;q[u+3]=gx_a/z}console.log("hermite = "+Math.round(Date.now()-y)/1E3+" s");a.getContext("2d").clearRect(0,0,Math.max(k,f),Math.max(h,l));a.width=f;a.height=l;a.getContext("2d").putImageData(B,0,0)};var h=document.getElementById("menu_imgre").getAttribute("imageurl");console.log(h);var y=!1;b.addEventListener("error",function(a){a.preventDefault();console.log("errored");y=!0});b.src=h;y?K():setTimeout(function(){L(a);document.getElementById("canvasImg").remove()},1E3)}function K(){var a=document.getElementById("menu_imgre").getAttribute("imageurl");console.log("attempting to upload");var c=new FormData;c.append("image",a);var b=new XMLHttpRequest;b.open("POST","https://api.imgur.com/3/image.json");b.onload=function(){var a=JSON.parse(b.responseText).data.link;alert(a)};b.onerror=function(){alert("error")};b.setRequestHeader("Authorization","Client-ID d8b88dd7493540b");b.send(c)}function L(a){console.log("attempting to upload");var c=new FormData;c.append("image",a.toDataURL().split(",")[1]);c.append("type","base64");var b=new XMLHttpRequest;b.open("POST","https://api.imgur.com/3/image.json");b.onload=function(){var a=JSON.parse(b.responseText).data.link;alert(a)};b.onerror=function(){alert("error")};b.setRequestHeader("Authorization","Client-ID d8b88dd7493540b");b.send(c)}document.addEventListener&&document.addEventListener("DOMContentLoaded",C(),!1);