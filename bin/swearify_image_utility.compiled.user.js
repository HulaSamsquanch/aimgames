// ==UserScript==
// @name        Swearify Image Utility
// @namespace   samsquanchhunter
// @include     *
// @version     alpha.1.3
// @icon        http://i.imgur.com/MnWNRBL.png
// @grant       none
// ==/UserScript==
// ==UserScript==// @name        Swearify Image Utility// @namespace   samsquanchhunter// @include     *// @version     alpha.1.3// @icon        http://i.imgur.com/MnWNRBL.png// @grant       none// ==/UserScript==Element.prototype.remove=function(){this.parentElement.removeChild(this)};NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var a=this.length-1;0<=a;a--)this[a]&&this[a].parentElement&&this[a].parentElement.removeChild(this[a])};function createStuff(){document.addEventListener("contextmenu",onRightClick,!1);if(0===document.getElementsByTagName("menu").length){var a=document.createElement("menu");a.id="userscript-grease";a.type="context"}else a=document.getElementsByTagName("menu")[0];var c=document.createElement("menuitem");c.id="menu_imgre";c.label="Resize and Upload";c.icon="http://i.imgur.com/F2wghzO.png";a.appendChild(c);document.body.appendChild(a);document.querySelector("#userscript-grease #menu_imgre").addEventListener("click",checkImageOrigin,!1)}function onRightClick(a){document.body.setAttribute("contextmenu","userscript-grease");var c=a.target;link=a.target.getAttribute("imageURL");a=document.querySelector("#userscript-grease #menu_imgre");"img"==c.localName?(a.disabled=!1,a.setAttribute("imageURL",c.src)):a.disabled=!0}function checkImageOrigin(){var a=window.location.origin,c=document.getElementById("menu_imgre").getAttribute("imageurl");console.log(a+" "+c);createCanvas()}function resample_hermite(a,c,b,e,g){var z=Date.now();e=Math.round(e);g=Math.round(g);for(var f=a.getContext("2d").getImageData(0,0,c,b),y=a.getContext("2d").getImageData(0,0,e,g),f=f.data,n=y.data,p=c/e,q=b/g,A=Math.ceil(p/2),B=Math.ceil(q/2),k=0;k<g;k++)for(var l=0;l<e;l++){for(var r=4*(l+k*e),d=0,m=0,w=0,x=gx_g=gx_b=gx_a=0,C=(k+.5)*q,t=Math.floor(k*q);t<(k+1)*q;t++)for(var u=Math.abs(C-(t+.5))/B,D=(l+.5)*p,u=u*u,v=Math.floor(l*p);v<(l+1)*p;v++){var h=Math.abs(D-(v+.5))/A,d=Math.sqrt(u+h*h);-1<=d&&1>=d&&(d=2*d*d*d-3*d*d+1,0<d&&(h=4*(v+t*c),gx_a+=d*f[h+3],w+=d,255>f[h+3]&&(d=d*f[h+3]/250),x+=d*f[h],gx_g+=d*f[h+1],gx_b+=d*f[h+2],m+=d))}n[r]=x/m;n[r+1]=gx_g/m;n[r+2]=gx_b/m;n[r+3]=gx_a/w}console.log("hermite = "+Math.round(Date.now()-z)/1E3+" s");a.getContext("2d").clearRect(0,0,Math.max(c,e),Math.max(b,g));a.width=e;a.height=g;a.getContext("2d").putImageData(y,0,0)}function createCanvas(){var a=document.createElement("canvas");a.id="canvasImg";a.style="display:none;";document.body.appendChild(a);resizeIntoCanvas()}function resizeIntoCanvas(){var a=document.getElementById("canvasImg"),c=a.getContext("2d"),b=new Image;b.crossOrigin="Anonymous";b.onload=function(){var e=b.width,f=b.height;a.width=e;a.height=f;c.drawImage(b,0,0);resample_hermite(a,e,f,Math.round(50/f*e),50)};var e=document.getElementById("menu_imgre").getAttribute("imageurl");console.log(e);var g=!1;b.addEventListener("error",function(a){a.preventDefault();console.log("errored");g=!0});b.src=e;g?uploadImagetoImgur(document.getElementById("menu_imgre").getAttribute("imageurl")):setTimeout(function(){uploadCanvastoImgur(a);document.getElementById("canvasImg").remove()},1E3)}function uploadImagetoImgur(a){console.log("attempting to upload");var c=new FormData;c.append("image",a);var b=new XMLHttpRequest;b.open("POST","https://api.imgur.com/3/image.json");b.onload=function(){var a=JSON.parse(b.responseText).data.link;alert(a)};b.onerror=function(){alert("error")};b.setRequestHeader("Authorization","Client-ID d8b88dd7493540b");b.send(c)}function uploadCanvastoImgur(a){console.log("attempting to upload");var c=new FormData;c.append("image",a.toDataURL().split(",")[1]);c.append("type","base64");var b=new XMLHttpRequest;b.open("POST","https://api.imgur.com/3/image.json");b.onload=function(){var a=JSON.parse(b.responseText).data.link;alert(a)};b.onerror=function(){alert("error")};b.setRequestHeader("Authorization","Client-ID d8b88dd7493540b");b.send(c)}document.addEventListener&&document.addEventListener("DOMContentLoaded",createStuff(),!1);